<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hentai Gallery</title>
  <link rel="stylesheet" href="stylebeta.css">
</head>
<body>
  <h1>Hentai</h1>
  <input type="text" id="search" placeholder="Cari gambar dan tekan Enter...">
  <div class="gallery" id="gallery"></div>
  <div id="loading">Loading...</div>

  <script>
    let currentPage = 5; // <- dimulai dari file terbaru
    const minPage = 1;
    const gallery = document.getElementById('gallery');
    const loading = document.getElementById('loading');
    const searchInput = document.getElementById('search');
    let isLoading = false;
  
    async function fetchJsonFile(page) {
      try {
        const response = await fetch(`images${page}.json`);
        if (!response.ok) throw new Error('File tidak ditemukan');
        return await response.json();
      } catch (err) {
        return [];
      }
    }
  
    function renderImages(images, insertOnTop = true) {
      images.forEach(image => {
        const item = document.createElement('div');
        item.classList.add('gallery-item');
  
        const link = document.createElement('a');
        link.href = image.link || '#';
        link.target = '_blank';
        link.innerHTML = `
          <img src="${image.url}" alt="${image.title}">
          <h3>${image.title}</h3>
        `;
  
        item.appendChild(link);
        if (insertOnTop) {
          gallery.prepend(item); // Masukkan ke atas
        } else {
          gallery.appendChild(item); // Masukkan ke bawah
        }
        setTimeout(() => item.classList.add('loaded'), 100);
      });
    }
  
    async function lazyLoadNextPage() {
      if (isLoading || currentPage < minPage) return;
      isLoading = true;
      loading.style.display = 'block';
  
      const data = await fetchJsonFile(currentPage);
      renderImages(data);
      currentPage--; // ← Load file sebelumnya (yang lebih lama)
      
      isLoading = false;
      loading.style.display = 'none';
    }
  
    async function searchAcrossAllPages(query) {
      gallery.innerHTML = '';
      loading.style.display = 'block';
      let allResults = [];
  
      for (let i = currentPage; i >= minPage; i--) {
        const data = await fetchJsonFile(i);
        const matches = data.filter(item => item.title.toLowerCase().includes(query.toLowerCase()));
        allResults = allResults.concat(matches);
      }
  
      renderImages(allResults, false); // tampilkan hasil cari dari paling lama ke baru
      loading.style.display = 'none';
    }
  
    window.addEventListener('scroll', () => {
      const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
      const isBottom = scrollTop + clientHeight >= scrollHeight - 10;
  
      if (isBottom && !searchInput.value.trim()) {
        lazyLoadNextPage();
      }
    });
  
    searchInput.addEventListener('keydown', (event) => {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
  
        if (query) {
          searchAcrossAllPages(query);
        } else {
          gallery.innerHTML = '';
          currentPage = 5;
          lazyLoadNextPage();
        }
      }
    });
  
    lazyLoadNextPage(); // mulai dari file terbaru
  </script>  
</body>
</html>
